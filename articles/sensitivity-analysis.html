<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="aemetools">
<title>Sensitivity Analysis • aemetools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sensitivity Analysis">
<meta property="og:description" content="aemetools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aemetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/calibrate-aeme.html">Calibrate AEME</a>
    <a class="dropdown-item" href="../articles/download-era5.html">Download ERA5 data</a>
    <a class="dropdown-item" href="../articles/sensitivity-analysis.html">Sensitivity Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sensitivity Analysis</h1>
            
      
      
      <div class="d-none name"><code>sensitivity-analysis.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, we will load the <code>AEME</code> and <code>aemetools</code>
package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://expert-guide-29ve1vw.pages.github.io/" class="external-link">AEME</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://studious-enigma-z736ppg.pages.github.io/" class="external-link">aemetools</a></span><span class="op">)</span></span></code></pre></div>
<p>Create a folder for running the example calibration setup.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="st">"sa-test"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tmpdir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">aeme_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/lake/"</span>, package <span class="op">=</span> <span class="st">"AEME"</span><span class="op">)</span></span>
<span><span class="co"># Copy files from package into tempdir</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">aeme_dir</span>, <span class="va">tmpdir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="st">"lake"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "aeme.yaml"            "data/catchment.dbf"   "data/catchment.prj"  </span></span>
<span><span class="co">#&gt;  [4] "data/catchment.shp"   "data/catchment.shx"   "data/hypsograph.csv" </span></span>
<span><span class="co">#&gt;  [7] "data/inflow_FWMT.csv" "data/lake.dbf"        "data/lake.prj"       </span></span>
<span><span class="co">#&gt; [10] "data/lake.shp"        "data/lake.shx"        "data/lake_obs.csv"   </span></span>
<span><span class="co">#&gt; [13] "data/meteo.csv"       "data/outflow.csv"     "data/water_level.csv"</span></span>
<span><span class="co">#&gt; [16] "model_controls.csv"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-aeme-ensemble">Build AEME ensemble<a class="anchor" aria-label="anchor" href="#build-aeme-ensemble"></a>
</h2>
<p>Using the <code>AEME</code> functions, we will build the AEME model
setup. For this example, we will use the <code>glm_aed</code> model. The
<code>build_ensemble</code> function will</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">aeme_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AEME/man/yaml_to_aeme.html" class="external-link">yaml_to_aeme</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, <span class="st">"aeme.yaml"</span><span class="op">)</span></span>
<span><span class="va">mod_ctrls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"model_controls.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">inf_factor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dy_cd"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"glm_aed"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"gotm_wet"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">outf_factor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dy_cd"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"glm_aed"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"gotm_wet"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm_aed"</span><span class="op">)</span></span>
<span><span class="va">aeme_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AEME/man/build_ensemble.html" class="external-link">build_ensemble</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, aeme_data <span class="op">=</span> <span class="va">aeme_data</span>,</span>
<span>                            model <span class="op">=</span> <span class="va">model</span>, mod_ctrls <span class="op">=</span> <span class="va">mod_ctrls</span>,</span>
<span>                            inf_factor <span class="op">=</span> <span class="va">inf_factor</span>, ext_elev <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                            use_bgc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-parameters-to-be-used-for-the-sensitivity-analysis">Load parameters to be used for the sensitivity analysis<a class="anchor" aria-label="anchor" href="#load-parameters-to-be-used-for-the-sensitivity-analysis"></a>
</h2>
<p>Parameters are loaded from the <code>aemetools</code> package within
the <code>aeme_parameters</code> dataframe. The parameters are stored in
a data frame with the following columns:</p>
<ul>
<li><p><code>model</code>: The model name</p></li>
<li><p><code>file</code>: The file name of the model parameter
file</p></li>
<li><p><code>name</code>: The parameter name</p></li>
<li><p><code>value</code>: The parameter value</p></li>
<li><p><code>min</code>: The minimum value of the parameter</p></li>
<li><p><code>max</code>: The maximum value of the parameter</p></li>
</ul>
<p>Parameters to be used for the calibration. (man)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"aeme_parameters"</span>, package <span class="op">=</span> <span class="st">"aemetools"</span><span class="op">)</span></span>
<span><span class="va">param</span> <span class="op">&lt;-</span> <span class="va">aeme_parameters</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">file</span> <span class="op">!=</span> <span class="st">"wdr"</span><span class="op">)</span></span>
<span><span class="va">param</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="10%">
<col width="16%">
<col width="41%">
<col width="14%">
<col width="7%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">model</th>
<th align="left">file</th>
<th align="left">name</th>
<th align="right">value</th>
<th align="right">min</th>
<th align="right">max</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">light/Kw</td>
<td align="right">0.5811660</td>
<td align="right">0.10</td>
<td align="right">5.52e+00</td>
</tr>
<tr class="even">
<td align="left">glm_aed</td>
<td align="left">met</td>
<td align="left">MET_wndspd</td>
<td align="right">1.1437400</td>
<td align="right">0.70</td>
<td align="right">1.30e+00</td>
</tr>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">met</td>
<td align="left">MET_radswd</td>
<td align="right">0.9661150</td>
<td align="right">0.70</td>
<td align="right">1.30e+00</td>
</tr>
<tr class="even">
<td align="left">gotm_wet</td>
<td align="left">gotm.yaml</td>
<td align="left">turbulence/turb_param/k_min</td>
<td align="right">0.0000006</td>
<td align="right">0.00</td>
<td align="right">1.00e-05</td>
</tr>
<tr class="odd">
<td align="left">gotm_wet</td>
<td align="left">gotm.yaml</td>
<td align="left">light_extinction/g2/constant_value</td>
<td align="right">0.2000000</td>
<td align="right">0.05</td>
<td align="right">2.70e+00</td>
</tr>
<tr class="even">
<td align="left">gotm_wet</td>
<td align="left">met</td>
<td align="left">MET_wndspd</td>
<td align="right">1.0691700</td>
<td align="right">0.70</td>
<td align="right">1.30e+00</td>
</tr>
<tr class="odd">
<td align="left">gotm_wet</td>
<td align="left">met</td>
<td align="left">MET_radswd</td>
<td align="right">1.1734000</td>
<td align="right">0.70</td>
<td align="right">1.30e+00</td>
</tr>
<tr class="even">
<td align="left">dy_cd</td>
<td align="left">cfg</td>
<td align="left">light_extinction_coefficient/7</td>
<td align="right">0.9000000</td>
<td align="right">0.10</td>
<td align="right">1.40e+00</td>
</tr>
<tr class="odd">
<td align="left">dy_cd</td>
<td align="left">dyresm3p1.par</td>
<td align="left">vertical_mixing_coeff/15</td>
<td align="right">200.0000000</td>
<td align="right">50.00</td>
<td align="right">7.50e+02</td>
</tr>
<tr class="even">
<td align="left">dy_cd</td>
<td align="left">met</td>
<td align="left">MET_wndspd</td>
<td align="right">1.0000000</td>
<td align="right">0.70</td>
<td align="right">1.30e+00</td>
</tr>
<tr class="odd">
<td align="left">dy_cd</td>
<td align="left">met</td>
<td align="left">MET_radswd</td>
<td align="right">1.0000000</td>
<td align="right">0.70</td>
<td align="right">1.30e+00</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis-setup">Sensitivity analysis setup<a class="anchor" aria-label="anchor" href="#sensitivity-analysis-setup"></a>
</h2>
<div class="section level3">
<h3 id="define-fitness-function">Define fitness function<a class="anchor" aria-label="anchor" href="#define-fitness-function"></a>
</h3>
<p>First, we will define a function for the sensitivity analysis
function to use to calculate the sensitivity of the model. This function
takes a dataframe as an argument. The dataframe contains the observed
data (<code>obs</code>) and the modelled data (<code>model</code>). The
function should return a single value.</p>
<p>Here we use the model mean.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate fitness</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Different functions can be applied to different variables. For
example, we can use the mean for water temperature and median for
chloophyll-a.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate fitness</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then these would be combined into a named list of functions which
will be passed to the <code>sa_aeme</code> function. They are named
according to the target variable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Create list of functions</span></span>
<span><span class="va">FUN_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>HYD_temp <span class="op">=</span> <span class="va">fit</span>, PHY_tchla <span class="op">=</span> <span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-control-parameters">Define control parameters<a class="anchor" aria-label="anchor" href="#define-control-parameters"></a>
</h3>
<p>Next, we will define the control parameters for the sensitivity
analysis. The control parameters are passed to the <code>sa_aeme</code>
function. The control parameters are as follows:</p>
<ul>
<li><p><code>N</code>: The initial sample size of the base sample
matrix.</p></li>
<li><p><code>ncore</code>: The number of cores to use for the
calibration. This is only used if parallel = <code>TRUE</code>. Default
to <code>parallel::detectCores() - 1.</code></p></li>
<li><p><code>na_value</code>: value to replace NA value when
returned.</p></li>
<li><p><code>parallel</code>: Logical value. If <code>TRUE</code>, the
sensitivity analysis will be run in parallel. If <code>FALSE</code>, it
will be run in series.</p></li>
<li><p><code>out_file</code>: A character string naming a file for
writing. Currently it can write to a .csv file or a database (.db; using
the duckDB package) file. If writing to a database, it creates a table
named “sa_output”.</p></li>
<li>
<p><code>vars_sim</code>: A named list of output variables for
sensitivity analysis. The name is user defined but each list must
contain:</p>
<ul>
<li><p><code>var</code>: The variable name to use for the sensitivity
analysis.</p></li>
<li><p><code>month</code>: A vector of months to use for the sensitivity
analysis.</p></li>
<li><p><code>depth_range</code>: A vector of length 2 with the minimum
and maximum depth range to use for the sensitivity analysis.</p></li>
</ul>
</li>
</ul>
<p>Here is an example for examining surface temperature (surf_temp) in
the months December to February, bottom temperature (bot_temp), (10 - 13
m) and also total chlorophyll-a (PHY_tchla) at the surface (0 - 2 m)
during the summer period.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fl">4</span>, ncore <span class="op">=</span> <span class="fl">2L</span>, na_value <span class="op">=</span> <span class="fl">999</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             out_file <span class="op">=</span> <span class="st">"results.csv"</span>,</span>
<span>             vars_sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>               surf_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"HYD_temp"</span>,</span>
<span>                                month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                depth_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># change to depth_range</span></span>
<span>               <span class="op">)</span>,</span>
<span>               bot_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"HYD_temp"</span>,</span>
<span>                               month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                               depth_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">13</span><span class="op">)</span></span>
<span>               <span class="op">)</span>,</span>
<span>               surf_chla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"PHY_tchla"</span>,</span>
<span>                              month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                              depth_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>               <span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="run-sensitivity-analysis">Run sensitivity analysis<a class="anchor" aria-label="anchor" href="#run-sensitivity-analysis"></a>
</h2>
<p>Once we have defined the fitness function, control parameters and
variables, we can run the sensitivity analysis. The <code>sa_aeme</code>
function takes the following arguments:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">sa_aeme</span></span></code></pre></div>
<div class="r-help-page">
<div class="container">

<table style="width: 100%;" class="table"><tr>
<td>sa_aeme</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2 id="sa_aeme">Conduct a sensitivity analysis on AEME model parameters</h2>

<h3>Arguments</h3>

<table class="table">
<tr>
<td><code id="sa_aeme_:_aeme_data">aeme_data</code></td>
<td>
<p>aeme; data object.</p>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_path">path</code></td>
<td>
<p>filepath; where input files are located relative to 'config'.</p>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_param">param</code></td>
<td>
<p>dataframe; of parameters read in from a csv file. Requires the
columns c("model", "file", "name", "value", "min", "max", "log")</p>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_model">model</code></td>
<td>
<p>string; for which model. Options are c("dy_cd", "glm_aed" and
"gotm_wet")</p>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_mod_ctrls">mod_ctrls</code></td>
<td>
<p>dataframe; of configuration loaded from
"mod_ctrls.csv".</p>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_FUN_list">FUN_list</code></td>
<td>
<p>list of functions; named according to the variables in the
<code>vars_sim</code>. Funtions are of the form <code style="white-space: pre;">⁠function(df)⁠</code> which will be used
to calculate model fit. If NULL, uses mean absolute error (MAE).</p>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_ctrl">ctrl</code></td>
<td>
<p>list; of controls for calibration function.
</p>

<ul>
<li> <p><code>VTR</code> Value to be reached. The optimization process will stop if
either the maximum number of iterations itermax is reached or the best
parameter vector bestmem has found a value fn(bestmem) &lt;= VTR. Default to
-Inf.
</p>
</li>
<li> <p><code>NP</code> number of population members. Defaults to NA; if the user does not
change the value of NP from NA it is reset as
<code>10 * sum(param$model == model)</code>. For many  problems it is best to set NP
to be at least 10 times the length of the parameter vector.
</p>
</li>
<li> <p><code>itermax</code> the maximum iteration (population generation) allowed.
Default is 200.
</p>
</li>
<li> <p><code>reltol</code> relative convergence tolerance. The algorithm stops if it is
unable to reduce the value by a factor of <code>reltol * (abs(val) + reltol)</code>.
Default = 0.07
</p>
</li>
<li> <p><code>cutoff</code>: The quantile cutoff used to select the parents for the next
generation. For example, if <code>cutoff = 0.25</code>, the best 25% of the population
will be used as parents for the next generation.
</p>
</li>
<li> <p><code>mutate</code> fraction of population to undergo mutation (0-1).
</p>
</li>
<li> <p><code>parallel</code> boolean; run calibration in parallel. Default to TRUE
</p>
</li>
<li> <p><code>out_file</code> filepath; to csv for calibration output to be written to.
Defaults to "results.csv"
</p>
</li>
<li> <p><code>na_value</code> value to replace NA values with in observations. Default to
</p>
</li>
</ul>
<ol><li> 
</li></ol>
<ul><li> <p><code>ncore</code>: The number of cores to use for the calibration. This is only used
if <code>parallel = TRUE</code>. Default to <code>parallel::detectCores() - 1</code>.
</p>
</li></ul>
</td>
</tr>
<tr>
<td><code id="sa_aeme_:_param_df">param_df</code></td>
<td>
<p>dataframe; of parameters read in from a csv file. Requires
the columns c("model", "file", "name", "value", "min", "max").</p>
</td>
</tr>
</table>
</div>
</div>
<p>The <code>sa_aeme</code> function writes the results to the file
specified. The <code>sa_aeme</code> function returns the
<code>ctrl</code> object with any updated values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run sensitivity analysis AEME model</span></span>
<span>  <span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sa_aeme.html">sa_aeme</a></span><span class="op">(</span>aeme_data <span class="op">=</span> <span class="va">aeme_data</span>, path <span class="op">=</span> <span class="va">path</span>, param <span class="op">=</span> <span class="va">param</span>,</span>
<span>                  model <span class="op">=</span> <span class="va">model</span>, ctrl <span class="op">=</span> <span class="va">ctrl</span>, mod_ctrls <span class="op">=</span> <span class="va">mod_ctrls</span>,</span>
<span>                  FUN_list <span class="op">=</span> <span class="va">FUN_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting indices for modelled variables [2024-01-15 04:13:38]</span></span>
<span><span class="co">#&gt; Complete! [2024-01-15 04:13:43]</span></span>
<span><span class="co">#&gt; Running sensitivity analysis in parallel using 1 cores with 80 parameter sets [2024-01-15 04:13:43]</span></span>
<span><span class="co">#&gt;        light.Kw MET_wndspd MET_radswd</span></span>
<span><span class="co">#&gt; mean      2.715     0.9960     1.0050</span></span>
<span><span class="co">#&gt; median    2.641     0.9906     1.0000</span></span>
<span><span class="co">#&gt; sd        1.488     0.1592     0.1635</span></span>
<span><span class="co">#&gt; Complete! [2024-01-15 04:20:32]</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tadhg Moore, Chris McBride.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
