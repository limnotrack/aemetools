<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calibrate AEME • aemetools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calibrate AEME">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aemetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/access-geospatial.html">Access geospatial data</a></li>
    <li><a class="dropdown-item" href="../articles/calibrate-aeme.html">Calibrate AEME</a></li>
    <li><a class="dropdown-item" href="../articles/download-era5.html">Download ERA5 data</a></li>
    <li><a class="dropdown-item" href="../articles/sensitivity-analysis.html">Sensitivity Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/limnotrack/aemetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="calibrate-aeme_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="calibrate-aeme_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="calibrate-aeme_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="calibrate-aeme_files/datatables-binding-0.33/datatables.js"></script><link href="calibrate-aeme_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="calibrate-aeme_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="calibrate-aeme_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="calibrate-aeme_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="calibrate-aeme_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calibrate AEME</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/limnotrack/aemetools/blob/main/vignettes/calibrate-aeme.Rmd" class="external-link"><code>vignettes/calibrate-aeme.Rmd</code></a></small>
      <div class="d-none name"><code>calibrate-aeme.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, we will load the <code>AEME</code> and <code>aemetools</code>
package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AEME</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://limnotrack.github.io/aemetools/" class="external-link">aemetools</a></span><span class="op">)</span></span></code></pre></div>
<p>Create a folder for running the example calibration setup.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># tmpdir &lt;- "calib-test"</span></span>
<span><span class="co"># dir.create(tmpdir, showWarnings = FALSE)</span></span>
<span><span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">aeme_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/lake/"</span>, package <span class="op">=</span> <span class="st">"AEME"</span><span class="op">)</span></span>
<span><span class="co"># Copy files from package into tempdir</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">aeme_dir</span>, <span class="va">tmpdir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="st">"lake"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "aeme.yaml"            "data/catchment.dbf"   "data/catchment.prj"  </span></span>
<span><span class="co">#&gt;  [4] "data/catchment.shp"   "data/catchment.shx"   "data/hypsograph.csv" </span></span>
<span><span class="co">#&gt;  [7] "data/inflow_FWMT.csv" "data/lake.dbf"        "data/lake.prj"       </span></span>
<span><span class="co">#&gt; [10] "data/lake.shp"        "data/lake.shx"        "data/lake_obs.csv"   </span></span>
<span><span class="co">#&gt; [13] "data/meteo.csv"       "data/outflow.csv"     "data/water_level.csv"</span></span>
<span><span class="co">#&gt; [16] "model_controls.csv"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="build-aeme-ensemble">Build AEME ensemble<a class="anchor" aria-label="anchor" href="#build-aeme-ensemble"></a>
</h2>
<p>Using the <code>AEME</code> functions, we will build the AEME model
setup. For this example, we will use the <code>glm_aed</code> model. The
<code>build_aeme</code> function will</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AEME/man/yaml_to_aeme.html" class="external-link">yaml_to_aeme</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, <span class="st">"aeme.yaml"</span><span class="op">)</span></span>
<span><span class="va">model_controls</span> <span class="op">&lt;-</span> <span class="fu">AEME</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AEME/man/get_model_controls.html" class="external-link">get_model_controls</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">inf_factor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dy_cd"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"glm_aed"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"gotm_wet"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">outf_factor</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dy_cd"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"glm_aed"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"gotm_wet"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm_aed"</span><span class="op">)</span></span>
<span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AEME/man/build_aeme.html" class="external-link">build_aeme</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">path</span>, aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span>, </span>
<span>                   model_controls <span class="op">=</span> <span class="va">model_controls</span>, inf_factor <span class="op">=</span> <span class="va">inf_factor</span>, </span>
<span>                   ext_elev <span class="op">=</span> <span class="fl">5</span>, use_bgc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Run the model ensemble using the <code>run_aeme</code> function to
make sure the current model setup is working.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AEME/man/run_aeme.html" class="external-link">run_aeme</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                 path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running models... (Have you tried parallelizing?) [2024-08-27 02:29:12]</span></span>
<span><span class="co">#&gt; GLM-AED run successful! [2024-08-27 02:29:13]</span></span>
<span><span class="co">#&gt; Model run complete![2024-08-27 02:29:13]</span></span>
<span><span class="co">#&gt; Retrieving and formatting temp for model glm_aed</span></span>
<span><span class="co">#&gt; Retrieving and formatting salt for model glm_aed</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aeme</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="calibrate-aeme_files/figure-html/run-aeme-example-1.png" alt="Water temperature contour plotfor the model output." width="768"><p class="caption">
Water temperature contour plotfor the model output.
</p>
</div>
</div>
<div class="section level2">
<h2 id="load-parameters-to-be-used-for-the-calibration">Load parameters to be used for the calibration<a class="anchor" aria-label="anchor" href="#load-parameters-to-be-used-for-the-calibration"></a>
</h2>
<p>Parameters are loaded from the <code>aemetools</code> package within
the <code>aeme_parameters</code> dataframe. The parameters are stored in
a data frame with the following columns:</p>
<ul>
<li><p><code>model</code>: The model name</p></li>
<li><p><code>file</code>: The file name of the model parameter file. For
meteorological scaling variables, “met” is used, whereas for scaling
factors for inflow and outflow, “inflow” an “outflow” is used
accordingly.</p></li>
<li><p><code>name</code>: The parameter name</p></li>
<li><p><code>value</code>: The parameter value</p></li>
<li><p><code>min</code>: The minimum value of the parameter</p></li>
<li><p><code>max</code>: The maximum value of the parameter</p></li>
<li><p><code>module</code>: The module of the parameter</p></li>
<li><p><code>group</code>: The group of the parameter. Only used for
phytoplankton and zooplankton parameters.</p></li>
</ul>
<p>Parameters to be used for the calibration.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"aeme_parameters"</span>, package <span class="op">=</span> <span class="st">"AEME"</span><span class="op">)</span></span>
<span><span class="va">aeme_parameters</span><span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pageLength <span class="op">=</span> <span class="fl">4</span>, scrollX <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],["glm_aed","glm_aed","glm_aed","glm_aed","glm_aed","glm_aed","glm_aed","glm_aed","glm_aed","glm_aed","gotm_wet","gotm_wet","gotm_wet","gotm_wet","gotm_wet","gotm_wet","gotm_wet","gotm_wet","dy_cd","dy_cd","dy_cd","dy_cd","dy_cd","dy_cd"],["glm3.nml","met","met","glm3.nml","glm3.nml","glm3.nml","glm3.nml","glm3.nml","wdr","inf","gotm.yaml","gotm.yaml","gotm.yaml","gotm.yaml","met","met","wdr","inf","cfg","dyresm3p1.par","met","met","wdr","inf"],["light/Kw","MET_wndspd","MET_radswd","mixing/coef_mix_conv","mixing/coef_wind_stir","mixing/coef_mix_shear","mixing/coef_mix_turb","mixing/coef_mix_hyp","outflow","inflow","turbulence/turb_param/k_min","light_extinction/A/constant_value","light_extinction/g1/constant_value","light_extinction/g2/constant_value","MET_wndspd","MET_radswd","outflow","inflow","light_extinction_coefficient/7","vertical_mixing_coeff/15","MET_wndspd","MET_radswd","outflow","inflow"],[0.58,1,1,0.14,0.21,0.14,0.5600000000000001,0.74,1,1,6.32e-07,0.55,0.59,0.2,1,1,1,1,0.9,200,1,1,1,1],[0.1,0.7,0.7,0.1,0.2,0.1,0.2,0.4,0.5,0.5,1e-09,0.395,0.44,0.05,0.7,0.7,0.5,0.5,0.1,50,0.7,0.7,0.5,0.5],[5.52,1.3,1.3,0.2,0.3,0.2,0.7,0.8,2.5,2.5,1e-05,0.659,0.74,2.7,1.3,1.3,2.5,2.5,1.4,750,1.3,1.3,2.5,2.5],["hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic","hydrodynamic"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>model<\/th>\n      <th>file<\/th>\n      <th>name<\/th>\n      <th>value<\/th>\n      <th>min<\/th>\n      <th>max<\/th>\n      <th>module<\/th>\n      <th>group<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"model","targets":1},{"name":"file","targets":2},{"name":"name","targets":3},{"name":"value","targets":4},{"name":"min","targets":5},{"name":"max","targets":6},{"name":"module","targets":7},{"name":"group","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script><p>This dataframe can be modified to change the parameter values. For
example, we can change the <code>light/Kw</code> parameter for the
<code>glm_aed</code> model to 0.1:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aeme_parameters</span><span class="op">[</span><span class="va">aeme_parameters</span><span class="op">$</span><span class="va">model</span> <span class="op">==</span> <span class="st">"glm_aed"</span> <span class="op">&amp;</span></span>
<span>                  <span class="va">aeme_parameters</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"light/Kw"</span>, <span class="st">"value"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">aeme_parameters</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="8%">
<col width="13%">
<col width="34%">
<col width="7%">
<col width="6%">
<col width="8%">
<col width="12%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">model</th>
<th align="left">file</th>
<th align="left">name</th>
<th align="right">value</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="left">module</th>
<th align="left">group</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">light/Kw</td>
<td align="right">1.0e-01</td>
<td align="right">0.100</td>
<td align="right">5.52e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">glm_aed</td>
<td align="left">met</td>
<td align="left">MET_wndspd</td>
<td align="right">1.0e+00</td>
<td align="right">0.700</td>
<td align="right">1.30e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">met</td>
<td align="left">MET_radswd</td>
<td align="right">1.0e+00</td>
<td align="right">0.700</td>
<td align="right">1.30e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">mixing/coef_mix_conv</td>
<td align="right">1.4e-01</td>
<td align="right">0.100</td>
<td align="right">2.00e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">mixing/coef_wind_stir</td>
<td align="right">2.1e-01</td>
<td align="right">0.200</td>
<td align="right">3.00e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">mixing/coef_mix_shear</td>
<td align="right">1.4e-01</td>
<td align="right">0.100</td>
<td align="right">2.00e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">mixing/coef_mix_turb</td>
<td align="right">5.6e-01</td>
<td align="right">0.200</td>
<td align="right">7.00e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">glm_aed</td>
<td align="left">glm3.nml</td>
<td align="left">mixing/coef_mix_hyp</td>
<td align="right">7.4e-01</td>
<td align="right">0.400</td>
<td align="right">8.00e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">glm_aed</td>
<td align="left">wdr</td>
<td align="left">outflow</td>
<td align="right">1.0e+00</td>
<td align="right">0.500</td>
<td align="right">2.50e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">glm_aed</td>
<td align="left">inf</td>
<td align="left">inflow</td>
<td align="right">1.0e+00</td>
<td align="right">0.500</td>
<td align="right">2.50e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">gotm_wet</td>
<td align="left">gotm.yaml</td>
<td align="left">turbulence/turb_param/k_min</td>
<td align="right">6.0e-07</td>
<td align="right">0.000</td>
<td align="right">1.00e-05</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">gotm_wet</td>
<td align="left">gotm.yaml</td>
<td align="left">light_extinction/A/constant_value</td>
<td align="right">5.5e-01</td>
<td align="right">0.395</td>
<td align="right">6.59e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">gotm_wet</td>
<td align="left">gotm.yaml</td>
<td align="left">light_extinction/g1/constant_value</td>
<td align="right">5.9e-01</td>
<td align="right">0.440</td>
<td align="right">7.40e-01</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">gotm_wet</td>
<td align="left">gotm.yaml</td>
<td align="left">light_extinction/g2/constant_value</td>
<td align="right">2.0e-01</td>
<td align="right">0.050</td>
<td align="right">2.70e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">gotm_wet</td>
<td align="left">met</td>
<td align="left">MET_wndspd</td>
<td align="right">1.0e+00</td>
<td align="right">0.700</td>
<td align="right">1.30e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">gotm_wet</td>
<td align="left">met</td>
<td align="left">MET_radswd</td>
<td align="right">1.0e+00</td>
<td align="right">0.700</td>
<td align="right">1.30e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">gotm_wet</td>
<td align="left">wdr</td>
<td align="left">outflow</td>
<td align="right">1.0e+00</td>
<td align="right">0.500</td>
<td align="right">2.50e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">gotm_wet</td>
<td align="left">inf</td>
<td align="left">inflow</td>
<td align="right">1.0e+00</td>
<td align="right">0.500</td>
<td align="right">2.50e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">dy_cd</td>
<td align="left">cfg</td>
<td align="left">light_extinction_coefficient/7</td>
<td align="right">9.0e-01</td>
<td align="right">0.100</td>
<td align="right">1.40e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">dy_cd</td>
<td align="left">dyresm3p1.par</td>
<td align="left">vertical_mixing_coeff/15</td>
<td align="right">2.0e+02</td>
<td align="right">50.000</td>
<td align="right">7.50e+02</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">dy_cd</td>
<td align="left">met</td>
<td align="left">MET_wndspd</td>
<td align="right">1.0e+00</td>
<td align="right">0.700</td>
<td align="right">1.30e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">dy_cd</td>
<td align="left">met</td>
<td align="left">MET_radswd</td>
<td align="right">1.0e+00</td>
<td align="right">0.700</td>
<td align="right">1.30e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">dy_cd</td>
<td align="left">wdr</td>
<td align="left">outflow</td>
<td align="right">1.0e+00</td>
<td align="right">0.500</td>
<td align="right">2.50e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">dy_cd</td>
<td align="left">inf</td>
<td align="left">inflow</td>
<td align="right">1.0e+00</td>
<td align="right">0.500</td>
<td align="right">2.50e+00</td>
<td align="left">hydrodynamic</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>This dataframe can be passed to the <code>run_aeme_param</code>
function to run AEME with the parameter values specified in the
dataframe. This function is different to the <code>run_aeme</code>
function in that it does not return an <code>aeme</code> object, but the
model output is generate within the lake folder.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_aeme_param.html">run_aeme_param</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, param <span class="op">=</span> <span class="va">aeme_parameters</span>,</span>
<span>                 model <span class="op">=</span> <span class="va">model</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running models... (Have you tried parallelizing?) [2024-08-27 02:29:27]</span></span>
<span><span class="co">#&gt; GLM-AED run successful! [2024-08-27 02:29:27]</span></span>
<span><span class="co">#&gt; Model run complete![2024-08-27 02:29:27]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calibration-setup">Calibration setup<a class="anchor" aria-label="anchor" href="#calibration-setup"></a>
</h2>
<div class="section level3">
<h3 id="define-fitness-function">Define fitness function<a class="anchor" aria-label="anchor" href="#define-fitness-function"></a>
</h3>
<p>First, we will define a function for the calibration function to use
to calculate the fitness of the model. This function takes a dataframe
as an argument. The dataframe contains the observed data
(<code>obs</code>) and the modelled data (<code>model</code>). The
function should return a single value.</p>
<p>Here we use the root mean square error (RMSE) as the fitness
function:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">RMSE</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>,</mo><mover><mi>y</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msqrt><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mover><mi>y</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><mi>N</mi></mfrac></msqrt></mrow><annotation encoding="application/x-tex">\text{RMSE}(y, \hat{y}) = \sqrt{\frac{\sum_{i=0}^{N - 1} (y_i - \hat{y}_i)^2}{N}}</annotation></semantics></math></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate fitness</span></span>
<span><span class="va">rmse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">obs</span> <span class="op">-</span> <span class="va">df</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Different functions can be applied to different variables. For
example, we can use the RMSE for the lake level and the mean absolute
error (MAE) for the water temperature:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to calculate fitness</span></span>
<span><span class="va">mae</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">obs</span> <span class="op">-</span> <span class="va">df</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then these would be combined into a named list of functions which
will be passed to the <code>calib_aeme</code> function. They are named
according to the target variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create list of functions</span></span>
<span><span class="va">FUN_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>HYD_temp <span class="op">=</span> <span class="va">mae</span>, LKE_lvlwtr <span class="op">=</span> <span class="va">rmse</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-control-parameters">Define control parameters<a class="anchor" aria-label="anchor" href="#define-control-parameters"></a>
</h3>
<p>Next, we will define the control parameters for the calibration. The
control parameters are generated using the <code>create_control</code>
funtion and are then passed to the <code>calib_aeme</code> function. The
control parameters for calibration are as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">create_control</span></span></code></pre></div>
<div class="r-help-page">
<div class="container"><main><table style="width: 100%;" class="table"><tr>
<td>create_control</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create control list for calibration or sensitivity analysis</h2>

<h3>Arguments</h3>

<table class="table">
<tr>
<td><code id="method">method</code></td>
<td>
<p>The method to be used. It can be either "calib" for calibration
or "sa" for sensitivity analysis.</p>
</td>
</tr>
<tr>
<td><code id="...">...</code></td>
<td>
<p>Additional arguments to be passed to the function
<code>create_control</code>. The arguments are different for calibration and
sensitivity analysis. There are arguments which are common to both methods:
</p>

<ul>
<li> <p><code>file_type</code> string; file type to write the output to. Options are c("csv",
"db"). Defaults to "db".
</p>
</li>
<li> <p><code>file_name</code> string; file name to write the output to. Defaults to
"results.db" if <code>file_type</code> is "db" and "simulation_metadata.csv" if
<code>file_type</code> is "csv".
</p>
</li>
<li> <p><code>na_value</code> value to replace NA values with in observations. Defaults to 999.
</p>
</li>
<li> <p><code>parallel</code> boolean; run calibration in parallel. Default to TRUE
</p>
</li>
<li> <p><code>ncore</code>: The number of cores to use for the calibration. This is only used
if <code>parallel = TRUE</code>. Default to <code>parallel::detectCores() - 1</code>.
</p>
</li>
</ul>
<p>For calibration, the arguments are:
</p>

<ul>
<li> <p><code>VTR</code> Value to be reached. The optimization process will stop if
either the maximum number of iterations itermax is reached or the best
parameter vector bestmem has found a value fn(bestmem) &lt;= VTR. Default to
-Inf.
</p>
</li>
<li> <p><code>NP</code> number of population members. Defaults to NA; if the user does not
change the value of NP from NA it is reset as
<code>10 * sum(param$model == model)</code>. For many  problems it is best to set NP
to be at least 10 times the length of the parameter vector.
</p>
</li>
<li> <p><code>itermax</code> the maximum iteration (population generation) allowed.
Default is 200.
</p>
</li>
<li> <p><code>reltol</code> relative convergence tolerance. The algorithm stops if it is
unable to reduce the value by a factor of <code>reltol * (abs(val) + reltol)</code>.
Default = 0.07
</p>
</li>
<li> <p><code>cutoff</code>: The quantile cutoff used to select the parents for the next
generation. For example, if <code>cutoff = 0.25</code>, the best 25% of the population
will be used as parents for the next generation.
</p>
</li>
<li> <p><code>mutate</code> fraction of population to undergo mutation (0-1).
</p>
</li>
<li> <p><code>c_method</code> character; the method to use for calibration. Options are
"CMAES" and "LHC". Defaults to "CMAES".
</p>
</li>
</ul>
<p>For sensitivity analysis, the arguments are:
</p>

<ul>
<li> <p><code>N</code>: The initial sample size of the base sample matrix.
</p>
</li>
<li> <p><code>vars_sim</code>: A named list of output variables for sensitivity analysis.
The name is user defined but each list must contain:
</p>

<ul>
<li> <p><code>var</code>: The variable name to use for the sensitivity analysis.
</p>
</li>
<li> <p><code>month</code>: A vector of months to use for the sensitivity analysis.
</p>
</li>
<li> <p><code>depth_range</code>: A vector of length 2 with the minimum and maximum depth
range to use for the sensitivity analysis.
</p>
</li>
</ul>
</li>
</ul>
</td>
</tr>
</table></main></div>
</div>
<p>Here is an example of the control parameters for calibration, with a
value-to-reach of 0, 40 members in each population, maximum number of
iterations of 400, a relative tolerance of 0.07, 25% of parameters in
each population need to be non-NA to be used as parents in the next
generation, 10% of the children parameters undergo random mutation,
parallel processing is used, the file type for writing the results is
CSV, the NA value is 999 and 2 cores are used for parallel processing.
The control parameters are stored in the <code>ctrl</code> object which
is then passed to the <code>calib_aeme</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_control.html">create_control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"calib"</span>, VTR <span class="op">=</span> <span class="fl">0</span>, NP <span class="op">=</span> <span class="fl">40</span>, itermax <span class="op">=</span> <span class="fl">400</span>, </span>
<span>                       reltol <span class="op">=</span> <span class="fl">0.07</span>, cutoff <span class="op">=</span> <span class="fl">0.25</span>, mutate <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>                       parallel <span class="op">=</span> <span class="cn">TRUE</span>, file_type <span class="op">=</span> <span class="st">"csv"</span>, </span>
<span>                       na_value <span class="op">=</span> <span class="fl">999</span>, ncore <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-variables">Define variables<a class="anchor" aria-label="anchor" href="#define-variables"></a>
</h3>
<p>Next we will select the variables to use for the calibration. The
variables selected need to use the AEME variable definition e.g.
<code>c("HYD_temp", "LKE_lvlwtr")</code>. Weights need to be attributed
to each of the variables. The weights are used to scale the fitness
value. This can be helpful if the variables have different units. For
example, if the temperature is in degrees Celsius and the water level is
in metres, then the water level will have a much larger impact on the
fitness value. Therefore, the weight for the water level should be much
smaller than the weight for the temperature.</p>
<p>The weights are specified in a named vector. The names of the vector
should be the same as the variable names.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HYD_temp"</span>, <span class="st">"LKE_lvlwtr"</span><span class="op">)</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HYD_temp"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"LKE_lvlwtr"</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="run-calibration">Run calibration<a class="anchor" aria-label="anchor" href="#run-calibration"></a>
</h2>
<p>Once we have defined the fitness function, control parameters and
variables, we can run the calibration. The <code>calib_aeme</code>
function takes the following arguments:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">calib_aeme</span></span></code></pre></div>
<div class="r-help-page">
<div class="container"><main><table style="width: 100%;" class="table"><tr>
<td>calib_aeme</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calibrate AEME model parameters using observations</h2>

<h3>Arguments</h3>

<table class="table">
<tr>
<td><code id="aeme">aeme</code></td>
<td>
<p>aeme; object.</p>
</td>
</tr>
<tr>
<td><code id="path">path</code></td>
<td>
<p>filepath; where input files are located relative to 'config'.</p>
</td>
</tr>
<tr>
<td><code id="param">param</code></td>
<td>
<p>dataframe; of parameters read in from a csv file. Requires the
columns c("model", "file", "name", "value", "min", "max", "log")</p>
</td>
</tr>
<tr>
<td><code id="model">model</code></td>
<td>
<p>string; for which model to calibrate. Only one model can be
passed. Options are c("dy_cd", "glm_aed" and "gotm_wet").</p>
</td>
</tr>
<tr>
<td><code id="model_controls">model_controls</code></td>
<td>
<p>dataframe; of configuration loaded from
"model_controls.csv".</p>
</td>
</tr>
<tr>
<td><code id="vars_sim">vars_sim</code></td>
<td>
<p>vector; of variables names to be used in the calculation of
model fit. Currently only supports using one variable.</p>
</td>
</tr>
<tr>
<td><code id="FUN_list">FUN_list</code></td>
<td>
<p>list of functions; named according to the variables in the
<code>vars_sim</code>. Funtions are of the form <code style="white-space: pre;">⁠function(df)⁠</code> which will be used
to calculate model fit. If NULL, uses mean absolute error (MAE).</p>
</td>
</tr>
<tr>
<td><code id="ctrl">ctrl</code></td>
<td>
<p>list; of controls for sensitivity analysis function created using
the <code>create_control</code> function. See create_control for
more details.</p>
</td>
</tr>
<tr>
<td><code id="weights">weights</code></td>
<td>
<p>vector; of weights for each variable in vars_sim. Default to
c(1).</p>
</td>
</tr>
<tr>
<td><code id="param_df">param_df</code></td>
<td>
<p>dataframe; of parameters to be used in the calibration.
Requires the columns c("model", "file", "name", "value", "min", "max"). This
is used to restart from a previous calibration.</p>
</td>
</tr>
</table></main></div>
</div>
<p>The <code>calib_aeme</code> function writes the calibration results
to the file specified after each generation. This allows the calibration
to be stopped and restarted at any time. The <code>calib_aeme</code>
function returns the <code>ctrl</code> object with any updated
values.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_aeme.html">calib_aeme</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, path <span class="op">=</span> <span class="va">path</span>,</span>
<span>                     param <span class="op">=</span> <span class="va">aeme_parameters</span>, model <span class="op">=</span> <span class="va">model</span>,</span>
<span>                     FUN_list <span class="op">=</span> <span class="va">FUN_list</span>, ctrl <span class="op">=</span> <span class="va">ctrl</span>, </span>
<span>                     vars_sim <span class="op">=</span> <span class="va">vars_sim</span>, weights <span class="op">=</span> <span class="va">weights</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting indices for glm_aed modelled variables [2024-08-27 02:29:28]</span></span>
<span><span class="co">#&gt; Completed glm_aed! [2024-08-27 02:29:29]</span></span>
<span><span class="co">#&gt; Calibrating in parallel for glm_aed using 2 cores...</span></span>
<span><span class="co">#&gt; Starting generation 1/10, 40 members. [2024-08-27 02:29:29]</span></span>
<span><span class="co">#&gt; Best fit: 1.04 (sd: 437.27)</span></span>
<span><span class="co">#&gt;             Parameters: [2.01, 0.881, 1.01, 0.122, 0.27, 0.158, 0.42, 0.631, 1.79, 1.93]</span></span>
<span><span class="co">#&gt; Writing output for generation 1 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:29:55]</span></span>
<span><span class="co">#&gt; Survival rate: 0.75</span></span>
<span><span class="co">#&gt; Starting generation 2/10, 40 members. [2024-08-27 02:29:55]</span></span>
<span><span class="co">#&gt; Writing output for generation 2 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:30:14]</span></span>
<span><span class="co">#&gt; Best fit: 0.88503 (sd: 157.74)</span></span>
<span><span class="co">#&gt; Survival rate: 0.98</span></span>
<span><span class="co">#&gt; Starting generation 3/10, 40 members. [2024-08-27 02:30:14]</span></span>
<span><span class="co">#&gt; Writing output for generation 3 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:30:34]</span></span>
<span><span class="co">#&gt; Best fit: 0.88503 (sd: 0.33677)</span></span>
<span><span class="co">#&gt; Survival rate: 1</span></span>
<span><span class="co">#&gt; Starting generation 4/10, 40 members. [2024-08-27 02:30:34]</span></span>
<span><span class="co">#&gt; Writing output for generation 4 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:30:54]</span></span>
<span><span class="co">#&gt; Best fit: 0.8527 (sd: 266.18)</span></span>
<span><span class="co">#&gt; Survival rate: 0.92</span></span>
<span><span class="co">#&gt; Starting generation 5/10, 40 members. [2024-08-27 02:30:54]</span></span>
<span><span class="co">#&gt; Writing output for generation 5 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:31:13]</span></span>
<span><span class="co">#&gt; Best fit: 0.81961 (sd: 220.26)</span></span>
<span><span class="co">#&gt; Survival rate: 0.95</span></span>
<span><span class="co">#&gt; Starting generation 6/10, 40 members. [2024-08-27 02:31:13]</span></span>
<span><span class="co">#&gt; Writing output for generation 6 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:31:33]</span></span>
<span><span class="co">#&gt; Best fit: 0.77973 (sd: 0.23469)</span></span>
<span><span class="co">#&gt; Survival rate: 1</span></span>
<span><span class="co">#&gt; Starting generation 7/10, 40 members. [2024-08-27 02:31:33]</span></span>
<span><span class="co">#&gt; Writing output for generation 7 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:31:52]</span></span>
<span><span class="co">#&gt; Best fit: 0.77973 (sd: 220.29)</span></span>
<span><span class="co">#&gt; Survival rate: 0.95</span></span>
<span><span class="co">#&gt; Starting generation 8/10, 40 members. [2024-08-27 02:31:52]</span></span>
<span><span class="co">#&gt; Writing output for generation 8 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:32:12]</span></span>
<span><span class="co">#&gt; Best fit: 0.77217 (sd: 266.24)</span></span>
<span><span class="co">#&gt; Survival rate: 0.92</span></span>
<span><span class="co">#&gt; Starting generation 9/10, 40 members. [2024-08-27 02:32:12]</span></span>
<span><span class="co">#&gt; Writing output for generation 9 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:32:32]</span></span>
<span><span class="co">#&gt; Best fit: 0.76766 (sd: 157.81)</span></span>
<span><span class="co">#&gt; Survival rate: 0.98</span></span>
<span><span class="co">#&gt; Starting generation 10/10, 40 members. [2024-08-27 02:32:32]</span></span>
<span><span class="co">#&gt; Writing output for generation 10 to simulation_data.csv with sim ID: 45819_glmaed_C_001 [2024-08-27 02:32:51]</span></span>
<span><span class="co">#&gt; Best fit: 0.76627 (sd: 220.3)</span></span>
<span><span class="co">#&gt; Survival rate: 0.95</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualise-calibration-results">Visualise calibration results<a class="anchor" aria-label="anchor" href="#visualise-calibration-results"></a>
</h2>
<p>The calibrations results can be read in using the
<code>read_calib</code> function. This function takes the following
arguments:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">read_calib</span></span></code></pre></div>
<div class="r-help-page">
<div class="container"><main><table style="width: 100%;" class="table"><tr>
<td>read_simulation_output</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Read calibration output</h2>

<h3>Arguments</h3>

<table class="table">
<tr>
<td><code id="ctrl">ctrl</code></td>
<td>
<p>list; of controls for sensitivity analysis function created using
the <code>create_control</code> function. See create_control for
more details.</p>
</td>
</tr>
<tr>
<td><code id="path">path</code></td>
<td>
<p>filepath; where input files are located relative to 'config'.</p>
</td>
</tr>
<tr>
<td><code id="file">file</code></td>
<td>
<p>file name; to read. Can be either a "csv" or "db" file and it
must be located within the path.</p>
</td>
</tr>
<tr>
<td><code id="sim_id">sim_id</code></td>
<td>
<p>A vector of simulation IDs to read.</p>
</td>
</tr>
</table></main></div>
</div>
<p>The <code>read_calib</code> function returns a dataframe with the
calibration results. The calibration results include the model,
generation, index (model run), parameter name, parameter value, fitness
value and the median fitness value for each generation.</p>
<p>These results can be visualised using the <code>plot_calib</code>
function. This function takes the following arguments:</p>
<ul>
<li>
<code>calib</code>: The calibration results as read in using the
<code>read_calib</code> function.</li>
<li>
<code>model</code>: The model used for the calibration.</li>
<li>
<code>ctrl</code>: The control parameters used for the
calibration.</li>
</ul>
<p>And returns a list of ggplot objects: a dotty plot, density plot and
convergence plot.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">calib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_simulation_output.html">read_calib</a></span><span class="op">(</span>ctrl <span class="op">=</span> <span class="va">ctrl</span>, sim_id <span class="op">=</span> <span class="va">sim_id</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span>
<span><span class="va">plist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_calib.html">plot_calib</a></span><span class="op">(</span>calib <span class="op">=</span> <span class="va">calib</span>, na_value <span class="op">=</span> <span class="va">ctrl</span><span class="op">$</span><span class="va">na_value</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="dotty-plot">Dotty plot<a class="anchor" aria-label="anchor" href="#dotty-plot"></a>
</h3>
<p>This can be used for comparing sensitivity across parameters. The
dotty plot shows the fitness value for each parameter value for each
generation. The fitness value is on the y-axis and the parameter value
is on the x-axis. It is faceted by the parameter name. The parameter
values are coloured by the generation. The best fitness value for each
generation is shown as a black line with a red dot.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plist</span><span class="op">$</span><span class="va">dotty</span></span></code></pre></div>
<p><img src="calibrate-aeme_files/figure-html/dotty-plot-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="histogram-plot">Histogram plot<a class="anchor" aria-label="anchor" href="#histogram-plot"></a>
</h3>
<p>This is useful for comparing the distribution of parameter values
across generations. The histogram plot shows the frequency of the
parameter values for each generation. The parameter values are on the
x-axis and the density is on the y-axis. It is faceted by the parameter
name.</p>
<p>If a parameter is converging on a value, then the histogram will show
a peak around that value. If a parameter is not converging on a value,
then the histogram will show a flat distribution.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plist</span><span class="op">$</span><span class="va">hist</span></span></code></pre></div>
<p><img src="calibrate-aeme_files/figure-html/histogram-plot-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="convergence-plot">Convergence plot<a class="anchor" aria-label="anchor" href="#convergence-plot"></a>
</h3>
<p>This is more generally used for assessing model convergence. The
convergence plot shows the values use over the iterations. The parameter
value is on the y-axis and the iteration is on the x-axis. It is faceted
by the parameter name. The parameter values are coloured by the
generation. The best fitness value for each generation is shown as a
solid horizontal black line.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plist</span><span class="op">$</span><span class="va">convergence</span></span></code></pre></div>
<p><img src="calibrate-aeme_files/figure-html/convergence-plot-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="assess-calibrated-values">Assess calibrated values<a class="anchor" aria-label="anchor" href="#assess-calibrated-values"></a>
</h2>
<p>The best parameter values can be extracted using the
<code>get_param</code> function. This function takes the following
arguments:</p>
<ul>
<li>
<code>calib</code>: The calibration results as read in using the
<code>read_calib</code> function.</li>
<li>
<code>na_value</code>: The value to use for missing values in the
observed and predicted data. This is used to indicate when the model
crashes and then can be easily removed from the calibration
results.</li>
<li>
<code>fit_col</code>: The name of the column in the calibration
results that contains the fitness value. Defaults to
<code>fit</code>.</li>
<li>
<code>best</code>: A logical indicating whether to return the best
parameter values or the entire calibration dataset. Defaults to
<code>FALSE</code>.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_param.html">get_param</a></span><span class="op">(</span><span class="va">calib</span>, na_value <span class="op">=</span> <span class="va">ctrl</span><span class="op">$</span><span class="va">na_value</span>, fit_col <span class="op">=</span> <span class="st">"fit"</span>, </span>
<span>                         best <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">best_params</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="7%">
<col width="13%">
<col width="7%">
<col width="14%">
<col width="8%">
<col width="3%">
<col width="19%">
<col width="5%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">sim_id</th>
<th align="left">model</th>
<th align="left">label</th>
<th align="left">fit_type</th>
<th align="right">parameter_value</th>
<th align="right">fit_value</th>
<th align="left">gen</th>
<th align="left">name</th>
<th align="left">group</th>
<th align="left">par</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">Kw</td>
<td align="left">fit</td>
<td align="right">1.242180</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">light/Kw</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">coef_mix_conv</td>
<td align="left">fit</td>
<td align="right">0.171075</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">mixing/coef_mix_conv</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">coef_mix_hyp</td>
<td align="left">fit</td>
<td align="right">0.588784</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">mixing/coef_mix_hyp</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">coef_mix_shear</td>
<td align="left">fit</td>
<td align="right">0.136224</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">mixing/coef_mix_shear</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">coef_mix_turb</td>
<td align="left">fit</td>
<td align="right">0.531337</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">mixing/coef_mix_turb</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">coef_wind_stir</td>
<td align="left">fit</td>
<td align="right">0.275590</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">mixing/coef_wind_stir</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">inflow</td>
<td align="left">fit</td>
<td align="right">1.817360</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">inflow</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">outflow</td>
<td align="left">fit</td>
<td align="right">1.825460</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">outflow</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">radswd</td>
<td align="left">fit</td>
<td align="right">0.959184</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">MET_radswd</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">45819_glmaed_C_001</td>
<td align="left">glm_aed</td>
<td align="left">wndspd</td>
<td align="left">fit</td>
<td align="right">0.770436</td>
<td align="right">0.766266</td>
<td align="left">1</td>
<td align="left">MET_wndspd</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>The best parameter values can be used to run the model and compare
the simulated values to the observed values. This can be done using the
<code>run_aeme_param</code> function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aeme</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_aeme_param.html">run_aeme_param</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, path <span class="op">=</span> <span class="va">path</span>,</span>
<span>                       param <span class="op">=</span> <span class="va">best_params</span>, model <span class="op">=</span> <span class="va">model</span>,</span>
<span>                       return_aeme <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Running models... (Have you tried parallelizing?) [2024-08-27 02:32:56]</span></span>
<span><span class="co">#&gt; GLM-AED run successful! [2024-08-27 02:32:57]</span></span>
<span><span class="co">#&gt; Model run complete![2024-08-27 02:32:57]</span></span>
<span><span class="co">#&gt; Retrieving and formatting temp for model glm_aed</span></span>
<span><span class="co">#&gt; Retrieving and formatting salt for model glm_aed</span></span></code></pre></div>
<p>The simulated values can be compared to the observed values using the
<code>assess_model</code> function. This function takes the following
arguments:</p>
<ul>
<li>
<code>aeme</code>: The <code>aeme</code> object which has
observations and model simulations.</li>
<li>
<code>model</code>: The model to assess.</li>
<li>
<code>var_sim</code>: The variables to use for the assessment.</li>
</ul>
<p>The <code>assess_model</code> function returns:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">assess_model</span></span></code></pre></div>
<div class="r-help-page">
<div class="container"><main><table style="width: 100%;" class="table"><tr>
<td>assess_model</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Assess model performance</h2>

<h3>Value</h3>

<p>Data frame with model performance statistics for each model and
variable. These include:
</p>

<ul>
<li>
<p>bias - Bias
</p>
</li>
<li>
<p>mae - Mean absolute error
</p>
</li>
<li>
<p>rmse - Root mean square error
</p>
</li>
<li>
<p>nmae - Normalised mean absolute error
</p>
</li>
<li>
<p>nse - Nash-Sutcliffe efficiency
</p>
</li>
<li>
<p>d2 - Index of agreement model skill score Willmott index
</p>
</li>
<li>
<p>r - Pearson correlation coefficient
</p>
</li>
<li>
<p>rs - Spearman correlation coefficient
</p>
</li>
<li>
<p>r2 - R-squared value from linear model
</p>
</li>
<li>
<p>B - Bardsley coefficient
</p>
</li>
<li>
<p>n - number of observations
</p>
</li>
</ul></main></div>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AEME/man/assess_model.html" class="external-link">assess_model</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span>, var_sim <span class="op">=</span> <span class="va">vars_sim</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="7%">
<col width="10%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="8%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="3%">
<col width="6%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">var_sim</th>
<th align="right">bias</th>
<th align="right">mae</th>
<th align="right">rmse</th>
<th align="right">nmae</th>
<th align="right">nse</th>
<th align="right">d2</th>
<th align="right">r</th>
<th align="right">rs</th>
<th align="right">r2</th>
<th align="right">B</th>
<th align="right">n</th>
<th align="right">obs_na</th>
<th align="right">sim_na</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">GLM-AED</td>
<td align="left">HYD_temp</td>
<td align="right">-0.945</td>
<td align="right">1.657</td>
<td align="right">1.825</td>
<td align="right">0.092</td>
<td align="right">0.656</td>
<td align="right">0.174</td>
<td align="right">0.870</td>
<td align="right">0.891</td>
<td align="right">0.758</td>
<td align="right">0.564</td>
<td align="right">125</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">GLM-AED</td>
<td align="left">LKE_lvlwtr</td>
<td align="right">0.703</td>
<td align="right">0.703</td>
<td align="right">0.752</td>
<td align="right">0.030</td>
<td align="right">-163.494</td>
<td align="right">0.861</td>
<td align="right">0.803</td>
<td align="right">0.830</td>
<td align="right">0.645</td>
<td align="right">0.004</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="visualise-model-performance">Visualise model performance<a class="anchor" aria-label="anchor" href="#visualise-model-performance"></a>
</h3>
<p>The model performance can be visualised using the
<code>plot_resid</code> function within the AEME package. This returns a
list of ggplot objects, a plot of residuals for each variable. This is a
multi-panel plot displaying residuals for:</p>
<ul>
<li>Observed vs. predicted values</li>
<li>Residuals vs. predicted values</li>
<li>Residuals vs. day of year</li>
<li>Residuals vs. quantiles of the observed values</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AEME/man/plot_resid.html" class="external-link">plot_resid</a></span><span class="op">(</span>aeme <span class="op">=</span> <span class="va">aeme</span>, model <span class="op">=</span> <span class="va">model</span>, var_sim <span class="op">=</span> <span class="va">vars_sim</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="water-temperature-residuals">Water temperature residuals<a class="anchor" aria-label="anchor" href="#water-temperature-residuals"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="va">HYD_temp</span></span></code></pre></div>
<p><img src="calibrate-aeme_files/figure-html/plot-residuals-plot-1.png" width="768"></p>
</div>
<div class="section level4">
<h4 id="lake-level-residuals">Lake level residuals<a class="anchor" aria-label="anchor" href="#lake-level-residuals"></a>
</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="va">LKE_lvlwtr</span></span></code></pre></div>
<p><img src="calibrate-aeme_files/figure-html/plot-residuals-plot-2-1.png" width="768"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tadhg Moore, Chris McBride.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
